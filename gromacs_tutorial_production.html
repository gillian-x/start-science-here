<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Production MD &mdash; start-science-here 0.0.1 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/sphinx_rtd_theme_ext_color_contrast.css" type="text/css" />
      <link rel="stylesheet" href="_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Analysis" href="gromacs_tutorial_analysis.html" />
    <link rel="prev" title="Equilibration Phase 2" href="gromacs_tutorial_equilibration_2.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> start-science-here
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="linux_tutorial.html">Linux tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="windows_susbsystem_for_linux.html">Windows subsystem for linux</a></li>
<li class="toctree-l1"><a class="reference internal" href="install_docker.html">Installation instructions for Docker</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="gromacs_tutorial.html">Gromacs Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="gromacs_tutorial.html#credit">Credit</a></li>
<li class="toctree-l2"><a class="reference internal" href="gromacs_tutorial.html#some-gromacs-basics">Some Gromacs Basics</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="gromacs_tutorial.html#lysozyme-tutorial">Lysozyme Tutorial</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="gromacs_tutorial_generate_topology.html">Generate Topology</a></li>
<li class="toctree-l3"><a class="reference internal" href="gromacs_tutorial_examine_topology.html">Examine Topology</a></li>
<li class="toctree-l3"><a class="reference internal" href="gromacs_tutorial_solvation.html">Solvation</a></li>
<li class="toctree-l3"><a class="reference internal" href="gromacs_tutorial_adding_ions.html">Adding Ions</a></li>
<li class="toctree-l3"><a class="reference internal" href="gromacs_tutorial_energy_minimization.html">Energy Minimization</a></li>
<li class="toctree-l3"><a class="reference internal" href="gromacs_tutorial_equilibration.html">Equilibration</a></li>
<li class="toctree-l3"><a class="reference internal" href="gromacs_tutorial_equilibration_2.html">Equilibration Phase 2</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Production MD</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#intermission">Intermission</a></li>
<li class="toctree-l4"><a class="reference internal" href="#continuation">Continuation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-gromacs-on-gpu">Running GROMACS on GPU</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="gromacs_tutorial_analysis.html">Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="gromacs_tutorial_more_analysis.html">More Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="gromacs_tutorial_more_analysis.html#summary">Summary</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="python_tutorial.html">Python Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="setting_up_python.html">Setting Up Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="git_tutorial.html">Git Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="first_project.html">Your first project</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Extras</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="raising_issues.html">Raising Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="propose_changes.html">Propose Changes</a></li>
<li class="toctree-l1"><a class="reference internal" href="downloading_files.html">Downloading Files from mybinder</a></li>
<li class="toctree-l1"><a class="reference internal" href="uploading_files.html">Uploading Files to mybinder</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Having Problems?</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html#contact">Contact</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">start-science-here</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="gromacs_tutorial.html">Gromacs Tutorial</a> &raquo;</li>
      <li>Production MD</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/kevinsawade/start-science-here/blob/main/docs/source/gromacs_tutorial_production.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<blockquote>
<div></div></blockquote>
<div class="section" id="production-md">
<span id="gromacs-production-label"></span><h1>Production MD<a class="headerlink" href="#production-md" title="Permalink to this headline"></a></h1>
<p>Upon completion of the two equilibration phases, the system is now well-equilibrated at the desired temperature and pressure. We are now ready to release the position restraints and run production MD for data collection. The process is just like we have seen before, as we will make use of the checkpoint file (which in this case now contains preserve pressure coupling information) to grompp. We will run a 1-ns MD simulation, the script for which can be found <a class="reference external" href="http://www.mdtutorials.com/gmx/lysozyme/Files/md.mdp">here</a>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ wget http://www.mdtutorials.com/gmx/lysozyme/Files/md.mdp
</pre></div>
</div>
<div class="section" id="intermission">
<h2>Intermission<a class="headerlink" href="#intermission" title="Permalink to this headline"></a></h2>
<p>The production MD will probably not run in binder. We have to find a way to run the productioon MD on an actual computer and not on the cloud via binder. Here are the steps to achieve this:</p>
<ol class="arabic simple">
<li><p>Download a .zip archive with our current simulation.</p></li>
<li><p>Get to a linux terminal via using a computer with linux, or the Windows subsystem for linux: <a class="reference internal" href="windows_susbsystem_for_linux.html#wsl-label"><span class="std std-ref">Windows subsystem for linux</span></a>.</p></li>
<li><p>Install gromacs on that computer. Continue the run.</p></li>
<li><p>Upload files to WSL.</p></li>
</ol>
<div class="section" id="download-a-zip-archive-with-the-current-simulation">
<h3>Download a .zip archive with the current simulation<a class="headerlink" href="#download-a-zip-archive-with-the-current-simulation" title="Permalink to this headline"></a></h3>
<p>Go to the directory <code class="docutils literal notranslate"><span class="pre">~/home/jovyan</span></code> in binder and use <code class="docutils literal notranslate"><span class="pre">ls</span></code> to make sure, that the directory you’ve ran the sims in (<code class="docutils literal notranslate"><span class="pre">gromacs_tutorial/</span></code> or similar) is present. Otherwise browse the filesystem to find that directory. Use:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ zip -r gromacs_tutorial.zip gromacs_tutorial/
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">-r</span></code> flag tells zip to zip recursively (all sub-directories in <code class="docutils literal notranslate"><span class="pre">gromacs_tutorial/</span></code>). Check the filesize of the zip archive with:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ du -h gromacs_tutorial.zip
</pre></div>
</div>
<p>Download the .zip archive on binder: <a class="reference internal" href="downloading_files.html#downloading-files-label"><span class="std std-ref">Downloading Files from mybinder</span></a>.</p>
</div>
<div class="section" id="get-to-a-linux-terminal">
<h3>Get to a linux terminal<a class="headerlink" href="#get-to-a-linux-terminal" title="Permalink to this headline"></a></h3>
<p>If your computer runs any flavor of linux, you can skip this step, if you’re running Windows, please use the guide over at <a class="reference internal" href="windows_susbsystem_for_linux.html#wsl-label"><span class="std std-ref">Windows subsystem for linux</span></a> to install the Windows subsystem for linux.</p>
</div>
<div class="section" id="install-gromacs">
<h3>Install Gromacs<a class="headerlink" href="#install-gromacs" title="Permalink to this headline"></a></h3>
<p>Once you are greeted by the bash prompt: <code class="docutils literal notranslate"><span class="pre">username&#64;hostname:~$</span></code> make sure, that you are running ubuntu, via</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ cat /etc/*release
</pre></div>
</div>
<p>If you are running Ubuntu, you can use <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">apt</span></code> to install gromacs.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ sudo apt install gromacs
</pre></div>
</div>
<p>If you are running any other flavor of linux, please refer to the the note below:</p>
<div class="dropdown admonition note">
<p class="admonition-title">Note</p>
<p>Please refer to the man pages of your package manager. Depending on what package manager you use you might want to use one of these commands:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ brew install gromacs # Mac OS X
$ yum install gromacs # RHEL
$ pacman install gromacs # Arch
</pre></div>
</div>
</div>
</div>
<div class="section" id="upload-files-to-wsl">
<h3>Upload files to WSL<a class="headerlink" href="#upload-files-to-wsl" title="Permalink to this headline"></a></h3>
<p>Because the WSL is somewhat buried inside the Windows system, we have to take some extra steps to put our .zip archive in our home directory. Inside WSL type</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ explorer.exe .
</pre></div>
</div>
<p>A window of the Windows explorer will open and you can put your .zip archive there. Last step is to unzip it via:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ unzip gromacs_turorial.zip
</pre></div>
</div>
</div>
</div>
<div class="section" id="continuation">
<h2>Continuation<a class="headerlink" href="#continuation" title="Permalink to this headline"></a></h2>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gmx grompp -f md.mdp -c npt.gro -t npt.cpt -p topol.top -o md_0_1.tpr
</pre></div>
</div>
<p>grompp will print an estimate for PME load, which will dictate how many processors should be dedicated to the PME calculation, and how many for the PP calculations. Refer to the GROMACS 4 <a class="reference external" href="http://dx.doi.org/10.1021/ct700301q">publication</a> and the manual for details.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Estimate</span> <span class="k">for</span> <span class="n">the</span> <span class="n">relative</span> <span class="n">computational</span> <span class="n">load</span> <span class="n">of</span> <span class="n">the</span> <span class="n">PME</span> <span class="n">mesh</span> <span class="n">part</span><span class="p">:</span> <span class="mf">0.22</span>
</pre></div>
</div>
<p>For a cubic box, the optimal setup will have a PME load of 0.25 (3:1 PP:PME - we’re very close to optimal!); for a dodecahedral box, the optimal PME load is 0.33 (2:1 PP:PME). When executing mdrun, the program should automatically determine the best number of processors to assign for the PP and PME calculations. Thus, make sure you indicate an appropriate number of threads/cores for your calculation (the value of -nt X), so that you can get the best performance.</p>
<p>Now, execute mdrun:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gmx mdrun -deffnm md_0_1
</pre></div>
</div>
<p>In GROMACS 2018, the PME calculations can be offloaded to graphical processing units (GPU), which speeds up the simulation substantially. Using a Titan Xp GPU, this system can be simulated at an astounding 295 ns/day!</p>
</div>
<div class="section" id="running-gromacs-on-gpu">
<h2>Running GROMACS on GPU<a class="headerlink" href="#running-gromacs-on-gpu" title="Permalink to this headline"></a></h2>
<p>As of version 4.6, GROMACS supports the use of GPU accelerators for running MD simulations. With the release of version 2018, the nonbonded interactions and PME are calculated on the GPU, with only bonded forces calculated on the CPU cores. When building GROMACS (see www.gromacs.org for installation instructions), GPU hardware will automatically be detected, if present. The minimum requirements for using GPU acceleration are the CUDA libraries and SDK, and a GPU with a compute capability of &gt;= 2.0. A nice list of some of the more common GPUs and their specifications can be found <a class="reference external" href="https://developer.nvidia.com/cuda-gpus">here</a>.</p>
<p>Assuming you have one GPU available, the mdrun command to make use of it is as simple as:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ gmx mdrun -deffnm md_0_1 -nb gpu
</pre></div>
</div>
<p>If you have more than one GPU available, or require customization of how the work is divided up via the hybrid parallelization scheme available in GROMACS, please consult the GROMACS manual and webpage. Such technical details are beyond the scope of this tutorial.</p>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="gromacs_tutorial_equilibration_2.html" class="btn btn-neutral float-left" title="Equilibration Phase 2" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="gromacs_tutorial_analysis.html" class="btn btn-neutral float-right" title="Analysis" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Kevin Sawade.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>